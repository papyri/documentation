<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: DDBIdentifier</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">DDBIdentifier</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/ddb_identifier_rb.html">
                app/models/ddb_identifier.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="Identifier.html">
                Identifier
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000167">after_rename</a>&nbsp;&nbsp;
      <a href="#M000165">before_commit</a>&nbsp;&nbsp;
      <a href="#M000163">collection_names_hash</a>&nbsp;&nbsp;
      <a href="#M000170">get_broken_leiden</a>&nbsp;&nbsp;
      <a href="#M000160">id_attribute</a>&nbsp;&nbsp;
      <a href="#M000174">is_reprinted?</a>&nbsp;&nbsp;
      <a href="#M000171">leiden_plus</a>&nbsp;&nbsp;
      <a href="#M000175">leiden_plus_to_xml</a>&nbsp;&nbsp;
      <a href="#M000161">n_attribute</a>&nbsp;&nbsp;
      <a href="#M000166">preprocess</a>&nbsp;&nbsp;
      <a href="#M000178">preprocess_leiden</a>&nbsp;&nbsp;
      <a href="#M000177">preview</a>&nbsp;&nbsp;
      <a href="#M000173">reprinted_in</a>&nbsp;&nbsp;
      <a href="#M000176">save_broken_leiden_plus_to_xml</a>&nbsp;&nbsp;
      <a href="#M000172">set_leiden_plus</a>&nbsp;&nbsp;
      <a href="#M000164">to_path</a>&nbsp;&nbsp;
      <a href="#M000168">update_commentary</a>&nbsp;&nbsp;
      <a href="#M000169">update_frontmatter_commentary</a>&nbsp;&nbsp;
      <a href="#M000162">xml_title_text</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">PATH_PREFIX</td>
          <td>=</td>
          <td class="context-item-value">'DDB_EpiDoc_XML'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">COLLECTION_XML_PATH</td>
          <td>=</td>
          <td class="context-item-value">'DDB_SGML/collection.xml'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">FRIENDLY_NAME</td>
          <td>=</td>
          <td class="context-item-value">&quot;Text&quot;</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">IDENTIFIER_NAMESPACE</td>
          <td>=</td>
          <td class="context-item-value">'ddbdp'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">TEMPORARY_COLLECTION</td>
          <td>=</td>
          <td class="context-item-value">'sosol'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">XML_VALIDATOR</td>
          <td>=</td>
          <td class="context-item-value">JRubyXML::EpiDocP5Validator</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">BROKE_LEIDEN_MESSAGE</td>
          <td>=</td>
          <td class="context-item-value">&quot;Broken Leiden+ below saved to come back to later:\n&quot;</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000163" class="method-detail">
        <a name="M000163"></a>

        <div class="method-heading">
          <a href="#M000163" class="method-signature">
          <span class="method-name">collection_names_hash</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000163-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000163-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 34</span>
34:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">collection_names_hash</span>
35:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">collection_names</span>
36:     
37:     <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-ivar">@collection_names_hash</span>
38:       <span class="ruby-ivar">@collection_names_hash</span> = {<span class="ruby-constant">TEMPORARY_COLLECTION</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;SoSOL&quot;</span>}
39:       <span class="ruby-identifier">response</span> = 
40:         <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span>.<span class="ruby-identifier">sparql_query_to_numbers_server_response</span>(
41:           <span class="ruby-value str">&quot;prefix dc: &lt;http://purl.org/dc/terms/&gt; construct { ?ddb dc:bibliographicCitation ?bibl} from &lt;rmi://localhost/papyri.info#pi&gt; where {?ddb dc:isPartOf &lt;http://papyri.info/ddbdp&gt; . ?ddb dc:bibliographicCitation ?bibl}\n&amp;default-graph-uri=rmi://localhost/papyri.info#pi&amp;format=rdfxml&quot;</span>
42:         )
43:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'200'</span>
44:         <span class="ruby-ivar">@collection_names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">collection_name</span><span class="ruby-operator">|</span>
45:           <span class="ruby-identifier">xpath</span> = <span class="ruby-node">&quot;/rdf:RDF/rdf:Description[@rdf:about=\&quot;http://papyri.info/ddbdp/#{collection_name}\&quot;]/dcterms:bibliographicCitation/text()&quot;</span>
46:           <span class="ruby-identifier">human_name</span> = 
47:             <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span>.<span class="ruby-identifier">process_numbers_server_response_body</span>(
48:               <span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">xpath</span>).<span class="ruby-identifier">first</span>
49:           <span class="ruby-ivar">@collection_names_hash</span>[<span class="ruby-identifier">collection_name</span>] = <span class="ruby-identifier">human_name</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">human_name</span>.<span class="ruby-identifier">nil?</span>
50:         <span class="ruby-keyword kw">end</span>
51:       <span class="ruby-keyword kw">end</span>
52:     <span class="ruby-keyword kw">end</span>
53:     
54:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@collection_names_hash</span>
55:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000166" class="method-detail">
        <a name="M000166"></a>

        <div class="method-heading">
          <a href="#M000166" class="method-signature">
          <span class="method-name">preprocess</span><span class="method-args">(content)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000166-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000166-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 96</span>
 96:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">preprocess</span>(<span class="ruby-identifier">content</span>)
 97:     <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">apply_xsl_transform</span>(
 98:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(<span class="ruby-identifier">content</span>),
 99:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_file</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>,
100:         <span class="ruby-node">%w{data xslt ddb preprocess.xsl}</span>)))
101:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000167" class="method-detail">
        <a name="M000167"></a>

        <div class="method-heading">
          <a href="#M000167" class="method-signature">
          <span class="method-name">after_rename</span><span class="method-args">(options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000167-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000167-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 103</span>
103:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_rename</span>(<span class="ruby-identifier">options</span> = {})
104:     <span class="ruby-comment cmt"># copy back the content to the original name before we update the header</span>
105:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:set_dummy_header</span>]
106:       <span class="ruby-identifier">original</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:original</span>]
107:       <span class="ruby-identifier">dummy_comment_text</span> = <span class="ruby-node">&quot;Add dummy header for original identifier '#{original.name}' pointing to new identifier '#{self.name}'&quot;</span>
108:       <span class="ruby-identifier">dummy_header</span> =
109:         <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">apply_xsl_transform</span>(
110:           <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(<span class="ruby-identifier">content</span>),
111:           <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_file</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>,
112:             <span class="ruby-node">%w{data xslt ddb dummyize.xsl}</span>)),
113:           <span class="ruby-identifier">:reprint_in_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span>,
114:           <span class="ruby-identifier">:ddb_hybrid_ref_attribute</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">n_attribute</span>
115:         )
116:       
117:       <span class="ruby-identifier">original</span>.<span class="ruby-identifier">save!</span>
118:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">identifiers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">original</span>
119:       
120:       <span class="ruby-identifier">dummy_header</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_change_desc</span>(<span class="ruby-identifier">dummy_comment_text</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">owner</span>, <span class="ruby-identifier">dummy_header</span>)
121:       <span class="ruby-identifier">original</span>.<span class="ruby-identifier">set_xml_content</span>(<span class="ruby-identifier">dummy_header</span>, <span class="ruby-identifier">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">dummy_comment_text</span>)
122:             
123:       <span class="ruby-comment cmt"># need to do on originals too</span>
124:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">relatives</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">relative</span><span class="ruby-operator">|</span>
125:         <span class="ruby-identifier">original_relative</span> = <span class="ruby-identifier">relative</span>.<span class="ruby-identifier">clone</span>
126:         <span class="ruby-identifier">original_relative</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">original</span>.<span class="ruby-identifier">name</span>
127:         <span class="ruby-identifier">original_relative</span>.<span class="ruby-identifier">title</span> = <span class="ruby-identifier">original</span>.<span class="ruby-identifier">title</span>
128:         <span class="ruby-identifier">relative</span>.<span class="ruby-identifier">save!</span>
129:         
130:         <span class="ruby-identifier">relative</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">identifiers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">original_relative</span>
131:         
132:         <span class="ruby-comment cmt"># set the dummy header on the relative</span>
133:         <span class="ruby-identifier">original_relative</span>.<span class="ruby-identifier">set_xml_content</span>(<span class="ruby-identifier">dummy_header</span>, <span class="ruby-identifier">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">dummy_comment_text</span>)
134:       <span class="ruby-keyword kw">end</span>
135:     <span class="ruby-keyword kw">end</span>
136:     
137:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:update_header</span>]
138:       <span class="ruby-identifier">rewritten_xml</span> =
139:         <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">apply_xsl_transform</span>(
140:           <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(<span class="ruby-identifier">content</span>),
141:           <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_file</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>,
142:             <span class="ruby-node">%w{data xslt ddb update_header.xsl}</span>)),
143:           <span class="ruby-identifier">:title_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_title_text</span>,
144:           <span class="ruby-identifier">:human_title_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">titleize</span>,
145:           <span class="ruby-identifier">:filename_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id_attribute</span>,
146:           <span class="ruby-identifier">:ddb_hybrid_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">n_attribute</span>,
147:           <span class="ruby-identifier">:reprint_from_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:set_dummy_header</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>,
148:           <span class="ruby-identifier">:ddb_hybrid_ref_attribute</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:set_dummy_header</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">n_attribute</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>
149:         )
150:     
151:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_xml_content</span>(<span class="ruby-identifier">rewritten_xml</span>, <span class="ruby-identifier">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;Update header to reflect new identifier '#{self.name}'&quot;</span>)
152:     <span class="ruby-keyword kw">end</span>
153:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000165" class="method-detail">
        <a name="M000165"></a>

        <div class="method-heading">
          <a href="#M000165" class="method-signature">
          <span class="method-name">before_commit</span><span class="method-args">(content)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000165-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000165-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 92</span>
92:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">before_commit</span>(<span class="ruby-identifier">content</span>)
93:     <span class="ruby-constant">DDBIdentifier</span>.<span class="ruby-identifier">preprocess</span>(<span class="ruby-identifier">content</span>)
94:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000170" class="method-detail">
        <a name="M000170"></a>

        <div class="method-heading">
          <a href="#M000170" class="method-signature">
          <span class="method-name">get_broken_leiden</span><span class="method-args">(original_xml = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000170-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000170-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 186</span>
186:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_broken_leiden</span>(<span class="ruby-identifier">original_xml</span> = <span class="ruby-keyword kw">nil</span>)
187:     <span class="ruby-identifier">original_xml_content</span> = <span class="ruby-identifier">original_xml</span> <span class="ruby-operator">||</span> <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>)
188:     <span class="ruby-identifier">brokeleiden_path</span> = <span class="ruby-value str">'/TEI/text/body/div[@type = &quot;edition&quot;]/div[@subtype = &quot;brokeleiden&quot;]/note'</span>
189:     <span class="ruby-identifier">brokeleiden_here</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">XPath</span>.<span class="ruby-identifier">first</span>(<span class="ruby-identifier">original_xml_content</span>, <span class="ruby-identifier">brokeleiden_path</span>)
190:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">brokeleiden_here</span>.<span class="ruby-identifier">nil?</span>
191:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
192:     <span class="ruby-keyword kw">else</span>
193:       <span class="ruby-identifier">brokeleiden</span> = <span class="ruby-identifier">brokeleiden_here</span>.<span class="ruby-identifier">get_text</span>.<span class="ruby-identifier">value</span>
194:       
195:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">brokeleiden</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-node">/^#{Regexp.escape(BROKE_LEIDEN_MESSAGE)}/</span>,<span class="ruby-value str">''</span>)
196:     <span class="ruby-keyword kw">end</span>
197:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000160" class="method-detail">
        <a name="M000160"></a>

        <div class="method-heading">
          <a href="#M000160" class="method-signature">
          <span class="method-name">id_attribute</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000160-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000160-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 17</span>
17:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">id_attribute</span>
18:     <span class="ruby-identifier">ddb_collection_name</span>, <span class="ruby-identifier">ddb_volume_number</span>, <span class="ruby-identifier">ddb_document_number</span> =
19:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_components</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">';'</span>)
20:     
21:     <span class="ruby-identifier">ddb_collection_name</span>.<span class="ruby-identifier">downcase!</span>
22:     
23:     <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">ddb_collection_name</span>, <span class="ruby-identifier">ddb_volume_number</span>, <span class="ruby-identifier">ddb_document_number</span>].<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">blank?</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-value str">'.'</span>)
24:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000174" class="method-detail">
        <a name="M000174"></a>

        <div class="method-heading">
          <a href="#M000174" class="method-signature">
          <span class="method-name">is_reprinted?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000174-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000174-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 241</span>
241:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_reprinted?</span>
242:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">reprinted_in</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">false</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">true</span>
243:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000171" class="method-detail">
        <a name="M000171"></a>

        <div class="method-heading">
          <a href="#M000171" class="method-signature">
          <span class="method-name">leiden_plus</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000171-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000171-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 199</span>
199:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">leiden_plus</span>
200:     <span class="ruby-identifier">original_xml</span> = <span class="ruby-constant">DDBIdentifier</span>.<span class="ruby-identifier">preprocess</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>)
201:     
202:     <span class="ruby-comment cmt"># strip xml:id from lb's</span>
203:     <span class="ruby-identifier">original_xml</span> = <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">apply_xsl_transform</span>(
204:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(<span class="ruby-identifier">original_xml</span>),
205:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_file</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>,
206:         <span class="ruby-node">%w{data xslt ddb strip_lb_ids.xsl}</span>)))
207:     
208:     <span class="ruby-identifier">original_xml_content</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">original_xml</span>)
209: 
210:     <span class="ruby-comment cmt"># if XML does not contain broke Leiden+ send XML to be converted to Leiden+ and return that</span>
211:     <span class="ruby-comment cmt"># otherwise, return nil (client can then get_broken_leiden)</span>
212:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">get_broken_leiden</span>(<span class="ruby-identifier">original_xml_content</span>).<span class="ruby-identifier">nil?</span>
213:       <span class="ruby-comment cmt"># get div type=edition from XML in string format for conversion</span>
214:       <span class="ruby-identifier">abs</span> = <span class="ruby-constant">DDBIdentifier</span>.<span class="ruby-identifier">get_div_edition</span>(<span class="ruby-identifier">original_xml</span>).<span class="ruby-identifier">to_s</span>
215:       <span class="ruby-comment cmt"># transform XML to Leiden+ </span>
216:       <span class="ruby-identifier">transformed</span> = <span class="ruby-constant">DDBIdentifier</span>.<span class="ruby-identifier">xml2nonxml</span>(<span class="ruby-identifier">abs</span>)
217:       
218:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">transformed</span>
219:     <span class="ruby-keyword kw">else</span>
220:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
221:     <span class="ruby-keyword kw">end</span>
222:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000175" class="method-detail">
        <a name="M000175"></a>

        <div class="method-heading">
          <a href="#M000175" class="method-signature">
          <span class="method-name">leiden_plus_to_xml</span><span class="method-args">(content)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000175-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000175-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 253</span>
253:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">leiden_plus_to_xml</span>(<span class="ruby-identifier">content</span>)
254: 
255:     <span class="ruby-comment cmt"># transform the Leiden+ to XML</span>
256:     <span class="ruby-identifier">nonx2x</span> = <span class="ruby-constant">DDBIdentifier</span>.<span class="ruby-identifier">nonxml2xml</span>(<span class="ruby-identifier">content</span>)
257:     
258:     <span class="ruby-comment cmt">#remove namespace from XML returned from XSugar</span>
259:     <span class="ruby-identifier">nonx2x</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/ xmlns:xml=&quot;http:\/\/www.w3.org\/XML\/1998\/namespace&quot;/</span>,<span class="ruby-value str">''</span>)
260:       
261:     <span class="ruby-identifier">transformed_xml_content</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(
262:       <span class="ruby-identifier">nonx2x</span>)
263:       
264:     <span class="ruby-comment cmt"># fetch the original content</span>
265:     <span class="ruby-identifier">original_xml_content</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>)
266:     
267:     <span class="ruby-comment cmt">#deletes div type=edition in current XML which includes &lt;div&gt; with subtype=brokeLeiden if it exists, </span>
268:     <span class="ruby-comment cmt">#all &lt;div&gt; type=textpart and/or &lt;ab&gt; tags</span>
269:     <span class="ruby-comment cmt">#the complete &lt;div&gt; type=edition will be replaced with new transformed_xml_content</span>
270:     <span class="ruby-identifier">original_xml_content</span>.<span class="ruby-identifier">delete_element</span>(<span class="ruby-value str">'/TEI/text/body/div[@type = &quot;edition&quot;]'</span>)
271:     
272:     <span class="ruby-comment cmt">#delete \n left after delete div edition so not keep adding newlines to XML content</span>
273:     <span class="ruby-identifier">original_xml_content</span>.<span class="ruby-identifier">delete_element</span>(<span class="ruby-value str">'/TEI/text/body/node()[last()]'</span>)
274:     
275:     <span class="ruby-identifier">modified_abs</span> = <span class="ruby-identifier">transformed_xml_content</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-value str">'/'</span>]
276:     
277:     <span class="ruby-identifier">original_edition</span> =  <span class="ruby-identifier">original_xml_content</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-value str">'/TEI/text/body'</span>]
278:     
279:     <span class="ruby-comment cmt"># put new div type=edition content in</span>
280:     <span class="ruby-identifier">original_edition</span>.<span class="ruby-identifier">add_text</span> <span class="ruby-identifier">modified_abs</span>[<span class="ruby-value">0</span>]
281:     
282:     <span class="ruby-comment cmt"># write back to a string and return it to calling </span>
283:     <span class="ruby-identifier">modified_xml_content</span> = <span class="ruby-value str">''</span>
284:     <span class="ruby-identifier">original_xml_content</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">modified_xml_content</span>)
285:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">modified_xml_content</span>
286:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000161" class="method-detail">
        <a name="M000161"></a>

        <div class="method-heading">
          <a href="#M000161" class="method-signature">
          <span class="method-name">n_attribute</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000161-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000161-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 26</span>
26:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">n_attribute</span>
27:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">to_components</span>[<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">';'</span>)
28:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000178" class="method-detail">
        <a name="M000178"></a>

        <div class="method-heading">
          <a href="#M000178" class="method-signature">
          <span class="method-name">preprocess_leiden</span><span class="method-args">(preprocessed_leiden)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000178-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000178-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 323</span>
323:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">preprocess_leiden</span>(<span class="ruby-identifier">preprocessed_leiden</span>)
324:     <span class="ruby-comment cmt"># mass substitute alternate keyboard characters for Leiden+ grammar characters</span>
325: 
326:     <span class="ruby-comment cmt"># strip tabs</span>
327:     <span class="ruby-identifier">preprocessed_leiden</span>.<span class="ruby-identifier">tr!</span>(<span class="ruby-value str">&quot;\t&quot;</span>,<span class="ruby-value str">''</span>)
328:     
329:     <span class="ruby-comment cmt"># consistent LT symbol (&lt;)</span>
330:     <span class="ruby-comment cmt"># \u2039 \u2329 \u27e8 \u3008 to \u003c')</span>
331:     <span class="ruby-identifier">preprocessed_leiden</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/[‚Äπ‚å©‚ü®„Äà]{1}/</span>,<span class="ruby-value str">'&lt;'</span>)
332:     
333:     <span class="ruby-comment cmt"># consistent GT symbol (&gt;)</span>
334:     <span class="ruby-comment cmt"># \u203a \u232a \u27e9 \u3009 to \u003e')</span>
335:     <span class="ruby-identifier">preprocessed_leiden</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/[‚Ä∫‚å™‚ü©„Äâ]{1}/</span>,<span class="ruby-value str">'&gt;'</span>)
336:     
337:     <span class="ruby-comment cmt"># consistent Left square bracket („Äö)</span>
338:     <span class="ruby-comment cmt"># \u27e6 to \u301a')</span>
339:     <span class="ruby-identifier">preprocessed_leiden</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/‚ü¶/</span>,<span class="ruby-value str">'„Äö'</span>)
340:     
341:     <span class="ruby-comment cmt"># consistent Right square bracket („Äõ)</span>
342:     <span class="ruby-comment cmt"># \u27e7 to \u301b')</span>
343:     <span class="ruby-identifier">preprocessed_leiden</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/‚üß/</span>,<span class="ruby-value str">'„Äõ'</span>)
344:     
345:     <span class="ruby-comment cmt"># consistent macron (¬Ø)</span>
346:     <span class="ruby-comment cmt"># \u02c9 to \u00af')</span>
347:     <span class="ruby-identifier">preprocessed_leiden</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/Àâ/</span>,<span class="ruby-value str">'¬Ø'</span>)
348:     
349:     <span class="ruby-comment cmt"># consistent hyphen in linenumbers (-)</span>
350:     <span class="ruby-comment cmt"># immediately preceded by a period </span>
351:     <span class="ruby-comment cmt"># \u2010 \u2011 \u2012 \u2013 \u2212 \u10191 to \u002d')</span>
352:     <span class="ruby-identifier">preprocessed_leiden</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\.{1}[‚Äê‚Äë‚Äí‚Äì‚àíêÜë]{1}/</span>,<span class="ruby-value str">'.-'</span>)
353:     
354:     <span class="ruby-comment cmt"># consistent hyphen in gap ranges (-)</span>
355:     <span class="ruby-comment cmt"># between 2 numbers </span>
356:     <span class="ruby-comment cmt"># \u2010 \u2011 \u2012 \u2013 \u2212 \u10191 to \u002d')</span>
357:     <span class="ruby-identifier">preprocessed_leiden</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/(\d+)([‚Äê‚Äë‚Äí‚Äì‚àíêÜë]{1})(\d+)/</span>,<span class="ruby-value str">'\1-\3'</span>)
358:     
359:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">preprocessed_leiden</span>
360:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000177" class="method-detail">
        <a name="M000177"></a>

        <div class="method-heading">
          <a href="#M000177" class="method-signature">
          <span class="method-name">preview</span><span class="method-args">(parameters = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000177-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000177-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 315</span>
315:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">preview</span> <span class="ruby-identifier">parameters</span> = {}, <span class="ruby-identifier">xsl</span> = <span class="ruby-keyword kw">nil</span>
316:     <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">apply_xsl_transform</span>(
317:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>),
318:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_file</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>,
319:         <span class="ruby-identifier">xsl</span> <span class="ruby-value">? </span><span class="ruby-identifier">xsl</span> <span class="ruby-operator">:</span> <span class="ruby-node">%w{data xslt pn start-div-portlet.xsl}</span>)),
320:         <span class="ruby-identifier">parameters</span>)
321:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000173" class="method-detail">
        <a name="M000173"></a>

        <div class="method-heading">
          <a href="#M000173" class="method-signature">
          <span class="method-name">reprinted_in</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000173-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000173-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 236</span>
236:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reprinted_in</span>
237:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">XPath</span>.<span class="ruby-identifier">first</span>(<span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>),
238:       <span class="ruby-value str">&quot;/TEI/text/body/head/ref[@type='reprint-in']/@n&quot;</span>)
239:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000176" class="method-detail">
        <a name="M000176"></a>

        <div class="method-heading">
          <a href="#M000176" class="method-signature">
          <span class="method-name">save_broken_leiden_plus_to_xml</span><span class="method-args">(brokeleiden, commit_comment = '')</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000176-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000176-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 288</span>
288:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save_broken_leiden_plus_to_xml</span>(<span class="ruby-identifier">brokeleiden</span>, <span class="ruby-identifier">commit_comment</span> = <span class="ruby-value str">''</span>)
289:     <span class="ruby-comment cmt"># fetch the original content</span>
290:     <span class="ruby-identifier">original_xml_content</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>)
291:     <span class="ruby-comment cmt">#deletes XML with broke Leiden+ if it exists already so can add with updated data</span>
292:     <span class="ruby-identifier">original_xml_content</span>.<span class="ruby-identifier">delete_element</span>(<span class="ruby-value str">'/TEI/text/body/div[@type = &quot;edition&quot;]/div[@subtype = &quot;brokeleiden&quot;]'</span>)
293:     <span class="ruby-comment cmt">#set in XML where to add new div tag to contain broken Leiden+ and add it</span>
294:     <span class="ruby-identifier">basepath</span> = <span class="ruby-value str">'/TEI/text/body/div[@type = &quot;edition&quot;]'</span>
295:     <span class="ruby-identifier">add_node_here</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">XPath</span>.<span class="ruby-identifier">first</span>(<span class="ruby-identifier">original_xml_content</span>, <span class="ruby-identifier">basepath</span>)
296:     <span class="ruby-identifier">add_node_here</span>.<span class="ruby-identifier">add_element</span> <span class="ruby-value str">'div'</span>, {<span class="ruby-value str">'type'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">'edition'</span>, <span class="ruby-value str">'subtype'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">'brokeleiden'</span>}
297:     <span class="ruby-comment cmt">#set in XML where to add new note tag to contain broken Leiden+ and add it</span>
298:     <span class="ruby-identifier">basepath</span> = <span class="ruby-value str">'/TEI/text/body/div[@type = &quot;edition&quot;]/div[@subtype = &quot;brokeleiden&quot;]'</span>
299:     <span class="ruby-identifier">add_node_here</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">XPath</span>.<span class="ruby-identifier">first</span>(<span class="ruby-identifier">original_xml_content</span>, <span class="ruby-identifier">basepath</span>)
300:     <span class="ruby-identifier">add_node_here</span>.<span class="ruby-identifier">add_element</span> <span class="ruby-value str">&quot;note&quot;</span>
301:     <span class="ruby-comment cmt">#set in XML where to add broken Leiden+ and add it</span>
302:     <span class="ruby-identifier">basepath</span> = <span class="ruby-value str">'/TEI/text/body/div[@type = &quot;edition&quot;]/div[@subtype = &quot;brokeleiden&quot;]/note'</span>
303:     <span class="ruby-identifier">add_node_here</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">XPath</span>.<span class="ruby-identifier">first</span>(<span class="ruby-identifier">original_xml_content</span>, <span class="ruby-identifier">basepath</span>)
304:     <span class="ruby-identifier">brokeleiden</span> = <span class="ruby-constant">BROKE_LEIDEN_MESSAGE</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">brokeleiden</span>
305:     <span class="ruby-identifier">add_node_here</span>.<span class="ruby-identifier">add_text</span> <span class="ruby-identifier">brokeleiden</span>
306:     
307:     <span class="ruby-comment cmt"># write back to a string</span>
308:     <span class="ruby-identifier">modified_xml_content</span> = <span class="ruby-value str">''</span>
309:     <span class="ruby-identifier">original_xml_content</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">modified_xml_content</span>)
310:     
311:     <span class="ruby-comment cmt"># commit xml to repo</span>
312:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_xml_content</span>(<span class="ruby-identifier">modified_xml_content</span>, <span class="ruby-identifier">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">commit_comment</span>)
313:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000172" class="method-detail">
        <a name="M000172"></a>

        <div class="method-heading">
          <a href="#M000172" class="method-signature">
          <span class="method-name">set_leiden_plus</span><span class="method-args">(leiden_plus_content, comment)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a String of the SHA1 of the commit
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000172-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000172-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 225</span>
225:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_leiden_plus</span>(<span class="ruby-identifier">leiden_plus_content</span>, <span class="ruby-identifier">comment</span>)
226:     
227:     <span class="ruby-identifier">pp_leiden</span> = <span class="ruby-identifier">preprocess_leiden</span>(<span class="ruby-identifier">leiden_plus_content</span>)
228:     
229:     <span class="ruby-comment cmt"># transform back to XML</span>
230:     <span class="ruby-identifier">xml_content</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">leiden_plus_to_xml</span>(
231:       <span class="ruby-identifier">pp_leiden</span>)
232:     <span class="ruby-comment cmt"># commit xml to repo</span>
233:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_xml_content</span>(<span class="ruby-identifier">xml_content</span>, <span class="ruby-identifier">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">comment</span>)
234:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000164" class="method-detail">
        <a name="M000164"></a>

        <div class="method-heading">
          <a href="#M000164" class="method-signature">
          <span class="method-name">to_path</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000164-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000164-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 57</span>
57:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_path</span>
58:     <span class="ruby-identifier">path_components</span> = [ <span class="ruby-constant">PATH_PREFIX</span> ]
59:     
60:     <span class="ruby-identifier">ddb_collection_name</span>, <span class="ruby-identifier">ddb_volume_number</span>, <span class="ruby-identifier">ddb_document_number</span> =
61:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_components</span>[<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">'/'</span>).<span class="ruby-identifier">split</span>(<span class="ruby-value str">';'</span>)
62:       
63:     <span class="ruby-comment cmt"># switch commas to dashes</span>
64:     <span class="ruby-comment cmt"># e.g. 0001:13:2230,1 =&gt; bgu/bgu.13/bgu.13.2230-1.xml </span>
65:     <span class="ruby-identifier">ddb_document_number</span>.<span class="ruby-identifier">tr!</span>(<span class="ruby-value str">','</span>,<span class="ruby-value str">'-'</span>)
66:     
67:     <span class="ruby-comment cmt"># switch forward slashes to underscores</span>
68:     <span class="ruby-comment cmt"># e.g. 0014:2:1964/1967 =&gt; o.bodl/o.bodl.2/o.bodl.2.1964_1967.xml</span>
69:     <span class="ruby-identifier">ddb_document_number</span>.<span class="ruby-identifier">tr!</span>(<span class="ruby-value str">'/'</span>,<span class="ruby-value str">'_'</span>)
70:     
71:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ddb_collection_name</span>.<span class="ruby-identifier">nil?</span>
72:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;DDB Collection Name Not Found&quot;</span>
73:     <span class="ruby-keyword kw">end</span>
74:     
75:     <span class="ruby-comment cmt"># e.g. bgu.10</span>
76:     <span class="ruby-identifier">ddb_volume_path</span> = <span class="ruby-identifier">ddb_collection_name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'.'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ddb_volume_number</span>
77:     <span class="ruby-comment cmt"># e.g. bgu.10.1901.xml</span>
78:     <span class="ruby-identifier">ddb_xml_path_components</span> = []
79:     <span class="ruby-identifier">ddb_xml_path_components</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ddb_collection_name</span>
80:     <span class="ruby-identifier">ddb_xml_path_components</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ddb_volume_number</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ddb_volume_number</span>.<span class="ruby-identifier">empty?</span>
81:     <span class="ruby-identifier">ddb_xml_path_components</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ddb_document_number</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'xml'</span>
82:     <span class="ruby-identifier">ddb_xml_path</span> = <span class="ruby-identifier">ddb_xml_path_components</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">'.'</span>)
83:     
84:     <span class="ruby-identifier">path_components</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ddb_collection_name</span>
85:     <span class="ruby-identifier">path_components</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ddb_volume_path</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ddb_volume_number</span>.<span class="ruby-identifier">empty?</span>
86:     <span class="ruby-identifier">path_components</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ddb_xml_path</span>
87:     
88:     <span class="ruby-comment cmt"># e.g. DDB_EpiDoc_XML/bgu/bgu.10/bgu.10.1901.xml</span>
89:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">path_components</span>)
90:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000168" class="method-detail">
        <a name="M000168"></a>

        <div class="method-heading">
          <a href="#M000168" class="method-signature">
          <span class="method-name">update_commentary</span><span class="method-args">(line_id, reference, comment_content = '', original_item_id = '', delete_comment = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000168-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000168-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 155</span>
155:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_commentary</span>(<span class="ruby-identifier">line_id</span>, <span class="ruby-identifier">reference</span>, <span class="ruby-identifier">comment_content</span> = <span class="ruby-value str">''</span>, <span class="ruby-identifier">original_item_id</span> = <span class="ruby-value str">''</span>, <span class="ruby-identifier">delete_comment</span> = <span class="ruby-keyword kw">false</span>)
156:     <span class="ruby-identifier">rewritten_xml</span> =
157:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">apply_xsl_transform</span>(
158:         <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(
159:           <span class="ruby-constant">DDBIdentifier</span>.<span class="ruby-identifier">preprocess</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>)),
160:         <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_file</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>,
161:           <span class="ruby-node">%w{data xslt ddb update_commentary.xsl}</span>)),
162:         <span class="ruby-identifier">:line_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">line_id</span>,
163:         <span class="ruby-identifier">:reference</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">reference</span>,
164:         <span class="ruby-identifier">:content</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">comment_content</span>,
165:         <span class="ruby-identifier">:original_item_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">original_item_id</span>,
166:         <span class="ruby-identifier">:delete_comment</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">delete_comment</span> <span class="ruby-value">? </span><span class="ruby-value str">'true'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>)
167:       )
168:     
169:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_xml_content</span>(<span class="ruby-identifier">rewritten_xml</span>, <span class="ruby-identifier">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">''</span>)
170:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000169" class="method-detail">
        <a name="M000169"></a>

        <div class="method-heading">
          <a href="#M000169" class="method-signature">
          <span class="method-name">update_frontmatter_commentary</span><span class="method-args">(commentary_content, delete_commentary = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000169-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000169-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 172</span>
172:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_frontmatter_commentary</span>(<span class="ruby-identifier">commentary_content</span>, <span class="ruby-identifier">delete_commentary</span> = <span class="ruby-keyword kw">false</span>)
173:     <span class="ruby-identifier">rewritten_xml</span> =
174:       <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">apply_xsl_transform</span>(
175:         <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_string</span>(
176:           <span class="ruby-constant">DDBIdentifier</span>.<span class="ruby-identifier">preprocess</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">xml_content</span>)),
177:         <span class="ruby-constant">JRubyXML</span>.<span class="ruby-identifier">stream_from_file</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RAILS_ROOT</span>,
178:           <span class="ruby-node">%w{data xslt ddb update_frontmatter_commentary.xsl}</span>)),
179:         <span class="ruby-identifier">:content</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">commentary_content</span>,
180:         <span class="ruby-identifier">:delete_commentary</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">delete_commentary</span> <span class="ruby-value">? </span><span class="ruby-value str">'true'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>)
181:       )
182:     
183:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_xml_content</span>(<span class="ruby-identifier">rewritten_xml</span>, <span class="ruby-identifier">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">''</span>)
184:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000162" class="method-detail">
        <a name="M000162"></a>

        <div class="method-heading">
          <a href="#M000162" class="method-signature">
          <span class="method-name">xml_title_text</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000162-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000162-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/ddb_identifier.rb, line 30</span>
30:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">xml_title_text</span>
31:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id_attribute</span>
32:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>
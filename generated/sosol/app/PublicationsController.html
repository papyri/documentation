<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>Class: PublicationsController</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/controllers/publications_controller.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-advanced_create">#advanced_create</a>
    
    <li><a href="#method-i-allow_submit-3F">#allow_submit?</a>
    
    <li><a href="#method-i-archive">#archive</a>
    
    <li><a href="#method-i-archive_all">#archive_all</a>
    
    <li><a href="#method-i-archive_pub">#archive_pub</a>
    
    <li><a href="#method-i-become_finalizer">#become_finalizer</a>
    
    <li><a href="#method-i-confirm_archive">#confirm_archive</a>
    
    <li><a href="#method-i-confirm_archive_all">#confirm_archive_all</a>
    
    <li><a href="#method-i-confirm_delete">#confirm_delete</a>
    
    <li><a href="#method-i-confirm_withdraw">#confirm_withdraw</a>
    
    <li><a href="#method-i-create">#create</a>
    
    <li><a href="#method-i-create_from_identifier">#create_from_identifier</a>
    
    <li><a href="#method-i-create_from_list">#create_from_list</a>
    
    <li><a href="#method-i-create_from_selector">#create_from_selector</a>
    
    <li><a href="#method-i-create_from_templates">#create_from_templates</a>
    
    <li><a href="#method-i-destroy">#destroy</a>
    
    <li><a href="#method-i-determine_creatable_identifiers">#determine_creatable_identifiers</a>
    
    <li><a href="#method-i-edit">#edit</a>
    
    <li><a href="#method-i-edit_adjacent">#edit_adjacent</a>
    
    <li><a href="#method-i-edit_biblio">#edit_biblio</a>
    
    <li><a href="#method-i-edit_meta">#edit_meta</a>
    
    <li><a href="#method-i-edit_text">#edit_text</a>
    
    <li><a href="#method-i-edit_trans">#edit_trans</a>
    
    <li><a href="#method-i-expire_publication_cache">#expire_publication_cache</a>
    
    <li><a href="#method-i-finalize">#finalize</a>
    
    <li><a href="#method-i-finalize_review">#finalize_review</a>
    
    <li><a href="#method-i-find_publication">#find_publication</a>
    
    <li><a href="#method-i-index">#index</a>
    
    <li><a href="#method-i-master_list">#master_list</a>
    
    <li><a href="#method-i-new">#new</a>
    
    <li><a href="#method-i-ownership_guard">#ownership_guard</a>
    
    <li><a href="#method-i-publication_from_identifier">#publication_from_identifier</a>
    
    <li><a href="#method-i-publication_from_identifiers">#publication_from_identifiers</a>
    
    <li><a href="#method-i-show">#show</a>
    
    <li><a href="#method-i-submit">#submit</a>
    
    <li><a href="#method-i-vote">#vote</a>
    
    <li><a href="#method-i-withdraw">#withdraw</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./HgvMetaIdentifierHelper.html">HgvMetaIdentifierHelper</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvDate.html">HgvMetaIdentifierHelper::HgvDate</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvFormat.html">HgvMetaIdentifierHelper::HgvFormat</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvFuzzy.html">HgvMetaIdentifierHelper::HgvFuzzy</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvGeo.html">HgvMetaIdentifierHelper::HgvGeo</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvGeo/GeoSpot.html">HgvMetaIdentifierHelper::HgvGeo::GeoSpot</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvGeo/Place.html">HgvMetaIdentifierHelper::HgvGeo::Place</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvGeo/Provenance.html">HgvMetaIdentifierHelper::HgvGeo::Provenance</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvMentionedDate.html">HgvMetaIdentifierHelper::HgvMentionedDate</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvProvenance.html">HgvMetaIdentifierHelper::HgvProvenance</a>
  
    <li><a href="./HgvMetaIdentifierHelper/HgvPublication.html">HgvMetaIdentifierHelper::HgvPublication</a>
  
    <li><a href="./BiblioIdentifier.html">BiblioIdentifier</a>
  
    <li><a href="./BiblioIdentifier/Container.html">BiblioIdentifier::Container</a>
  
    <li><a href="./BiblioIdentifier/Note.html">BiblioIdentifier::Note</a>
  
    <li><a href="./BiblioIdentifier/PublicationPerson.html">BiblioIdentifier::PublicationPerson</a>
  
    <li><a href="./BiblioIdentifier/Publisher.html">BiblioIdentifier::Publisher</a>
  
    <li><a href="./BiblioIdentifier/RelatedArticle.html">BiblioIdentifier::RelatedArticle</a>
  
    <li><a href="./BiblioIdentifier/RelatedItem.html">BiblioIdentifier::RelatedItem</a>
  
    <li><a href="./BiblioIdentifier/Reviewee.html">BiblioIdentifier::Reviewee</a>
  
    <li><a href="./BiblioIdentifier/ShortTitle.html">BiblioIdentifier::ShortTitle</a>
  
    <li><a href="./JRubyXML.html">JRubyXML</a>
  
    <li><a href="./JRubyXML/EpiDocP4Validator.html">JRubyXML::EpiDocP4Validator</a>
  
    <li><a href="./JRubyXML/EpiDocP5Validator.html">JRubyXML::EpiDocP5Validator</a>
  
    <li><a href="./JRubyXML/JARVValidator.html">JRubyXML::JARVValidator</a>
  
    <li><a href="./JRubyXML/NamespaceContext.html">JRubyXML::NamespaceContext</a>
  
    <li><a href="./JRubyXML/ParseError.html">JRubyXML::ParseError</a>
  
    <li><a href="./JRubyXML/ParseErrorHandler.html">JRubyXML::ParseErrorHandler</a>
  
    <li><a href="./JRubyXML/RDFValidator.html">JRubyXML::RDFValidator</a>
  
    <li><a href="./JRubyXML/TransformErrorListener.html">JRubyXML::TransformErrorListener</a>
  
    <li><a href="./REXML.html">REXML</a>
  
    <li><a href="./REXML/Document.html">REXML::Document</a>
  
    <li><a href="./REXML/Element.html">REXML::Element</a>
  
    <li><a href="./REXML/XPath.html">REXML::XPath</a>
  
    <li><a href="./NumbersRDF.html">NumbersRDF</a>
  
    <li><a href="./NumbersRDF/NumbersHelper.html">NumbersRDF::NumbersHelper</a>
  
    <li><a href="./NumbersRDF/Timeout.html">NumbersRDF::Timeout</a>
  
    <li><a href="./Rpx.html">Rpx</a>
  
    <li><a href="./Rpx/RpxException.html">Rpx::RpxException</a>
  
    <li><a href="./Rpx/RpxHelper.html">Rpx::RpxHelper</a>
  
    <li><a href="./Comment.html">Comment</a>
  
    <li><a href="./Comment/CombineComment.html">Comment::CombineComment</a>
  
    <li><a href="./Doco.html">Doco</a>
  
    <li><a href="./Doco/DocoNode.html">Doco::DocoNode</a>
  
    <li><a href="./Grit.html">Grit</a>
  
    <li><a href="./Grit/Commit.html">Grit::Commit</a>
  
    <li><a href="./HGVMetaIdentifier.html">HGVMetaIdentifier</a>
  
    <li><a href="./HGVMetaIdentifier/HgvMetaConfiguration.html">HGVMetaIdentifier::HgvMetaConfiguration</a>
  
    <li><a href="./HGVTransGlossary.html">HGVTransGlossary</a>
  
    <li><a href="./HGVTransGlossary/Entry.html">HGVTransGlossary::Entry</a>
  
    <li><a href="./APISIdentifier.html">APISIdentifier</a>
  
    <li><a href="./AjaxProxyController.html">AjaxProxyController</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./BiblioFormBuilder.html">BiblioFormBuilder</a>
  
    <li><a href="./BiblioIdentifiersController.html">BiblioIdentifiersController</a>
  
    <li><a href="./Board.html">Board</a>
  
    <li><a href="./BoardsController.html">BoardsController</a>
  
    <li><a href="./CollectionIdentifier.html">CollectionIdentifier</a>
  
    <li><a href="./CollectionIdentifiersController.html">CollectionIdentifiersController</a>
  
    <li><a href="./CommentsController.html">CommentsController</a>
  
    <li><a href="./CommunitiesController.html">CommunitiesController</a>
  
    <li><a href="./Community.html">Community</a>
  
    <li><a href="./CrossSiteController.html">CrossSiteController</a>
  
    <li><a href="./DDBIdentifier.html">DDBIdentifier</a>
  
    <li><a href="./DdbIdentifiersController.html">DdbIdentifiersController</a>
  
    <li><a href="./Decree.html">Decree</a>
  
    <li><a href="./DecreesController.html">DecreesController</a>
  
    <li><a href="./DocosController.html">DocosController</a>
  
    <li><a href="./DocovideosController.html">DocovideosController</a>
  
    <li><a href="./Emailer.html">Emailer</a>
  
    <li><a href="./EmailerMailer.html">EmailerMailer</a>
  
    <li><a href="./EmailersController.html">EmailersController</a>
  
    <li><a href="./Event.html">Event</a>
  
    <li><a href="./EventsController.html">EventsController</a>
  
    <li><a href="./GitConf.html">GitConf</a>
  
    <li><a href="./HGVIdentifier.html">HGVIdentifier</a>
  
    <li><a href="./HGVTransIdentifier.html">HGVTransIdentifier</a>
  
    <li><a href="./HelperController.html">HelperController</a>
  
    <li><a href="./HgvMetaIdentifiersController.html">HgvMetaIdentifiersController</a>
  
    <li><a href="./HgvTransGlossariesController.html">HgvTransGlossariesController</a>
  
    <li><a href="./HgvTransIdentifiersController.html">HgvTransIdentifiersController</a>
  
    <li><a href="./Identifier.html">Identifier</a>
  
    <li><a href="./IdentifiersController.html">IdentifiersController</a>
  
    <li><a href="./Integer.html">Integer</a>
  
    <li><a href="./Leiden.html">Leiden</a>
  
    <li><a href="./LeidenController.html">LeidenController</a>
  
    <li><a href="./LinkingInfo.html">LinkingInfo</a>
  
    <li><a href="./MaintenanceMode.html">MaintenanceMode</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./PrettySsime.html">PrettySsime</a>
  
    <li><a href="./Publication.html">Publication</a>
  
    <li><a href="./PublicationsController.html">PublicationsController</a>
  
    <li><a href="./Rails.html">Rails</a>
  
    <li><a href="./RepositoriesController.html">RepositoriesController</a>
  
    <li><a href="./Repository.html">Repository</a>
  
    <li><a href="./RpxController.html">RpxController</a>
  
    <li><a href="./TranslationHelperController.html">TranslationHelperController</a>
  
    <li><a href="./TranslationLeiden.html">TranslationLeiden</a>
  
    <li><a href="./TranslationLeidenController.html">TranslationLeidenController</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UserController.html">UserController</a>
  
    <li><a href="./UserIdentifier.html">UserIdentifier</a>
  
    <li><a href="./Vote.html">Vote</a>
  
    <li><a href="./VotesController.html">VotesController</a>
  
    <li><a href="./WelcomeController.html">WelcomeController</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class PublicationsController</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-advanced_create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">advanced_create</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="advanced_create-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 14</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">advanced_create</span>()
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- advanced_create-source -->
          
        </div>

        

        
      </div><!-- advanced_create-method -->

    
      <div id="method-i-archive" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">archive</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="archive-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 604</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">archive</span>
  <span class="ruby-identifier">archive_pub</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-identifier">expire_publication_cache</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@publication</span>    
<span class="ruby-keyword">end</span></pre>
          </div><!-- archive-source -->
          
        </div>

        

        
      </div><!-- archive-method -->

    
      <div id="method-i-archive_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">archive_all</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p>loop thru all the committed publication ids and archive each one</p>
</li><li>
<p>clear the cache</p>
</li><li>
<p>go to the dashboard</p>
</li></ul>
          

          
          <div class="method-source-code" id="archive_all-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 613</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">archive_all</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:pub_ids</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span>
     <span class="ruby-identifier">archive_pub</span>(<span class="ruby-identifier">id</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">expire_publication_cache</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span> 
<span class="ruby-keyword">end</span></pre>
          </div><!-- archive_all-source -->
          
        </div>

        

        
      </div><!-- archive_all-method -->

    
      <div id="method-i-become_finalizer" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">become_finalizer</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="become_finalizer-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 210</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">become_finalizer</span>
  
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">change_finalizer</span>(<span class="ruby-ivar">@current_user</span>)
    <span class="ruby-comment"># TODO make sure we don't steal it from someone who is working on it</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#no finalizer exists so pick one</span>
    <span class="ruby-comment">#@publication = Publication.find(params[:id])</span>
    <span class="ruby-comment">#@publication.remove_finalizer</span>
    
    <span class="ruby-comment">#note this can only be called on a board owned publication</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">owner_type</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Board&quot;</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">&quot;Can't change finalizer on non-board copy of publication.&quot;</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">show</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">send_to_finalizer</span>(<span class="ruby-ivar">@current_user</span>)
    
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#redirect_to (dashboard_url) #:controller =&gt; &quot;publications&quot;, :action =&gt; &quot;finalize_review&quot; , :id =&gt; new_publication_id</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'user'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dashboard'</span>, <span class="ruby-value">:board_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">owner</span>.<span class="ruby-identifier">id</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- become_finalizer-source -->
          
        </div>

        

        
      </div><!-- become_finalizer-method -->

    
      <div id="method-i-confirm_archive" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">confirm_archive</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="confirm_archive-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 587</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">confirm_archive</span>
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- confirm_archive-source -->
          
        </div>

        

        
      </div><!-- confirm_archive-method -->

    
      <div id="method-i-confirm_archive_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">confirm_archive_all</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="confirm_archive_all-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 591</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">confirm_archive_all</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">developer</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">admin</span>
      <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:warning</span>] = <span class="ruby-string">&quot;You are going to archive publications you do not own as either a developer or an admin.&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">'You are only allowed to archive your publications.'</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@publications</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find_all_by_owner_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>], <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:owner_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'User'</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'committed'</span>, <span class="ruby-value">:creator_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>], <span class="ruby-value">:parent_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span> }, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;updated_at DESC&quot;</span>)
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- confirm_archive_all-source -->
          
        </div>

        

        
      </div><!-- confirm_archive_all-method -->

    
      <div id="method-i-confirm_delete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">confirm_delete</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="confirm_delete-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 646</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">confirm_delete</span>
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- confirm_delete-source -->
          
        </div>

        

        
      </div><!-- confirm_delete-method -->

    
      <div id="method-i-confirm_withdraw" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">confirm_withdraw</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="confirm_withdraw-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 621</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">confirm_withdraw</span>
 <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- confirm_withdraw-source -->
          
        </div>

        

        
      </div><!-- confirm_withdraw-method -->

    
      <div id="method-i-create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>POST /publications POST /publications.xml</p>
          

          
          <div class="method-source-code" id="create-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create</span>
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">new</span>()
  <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-ivar">@current_user</span>
  <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">populate_identifiers_from_identifiers</span>(
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:pn_id</span>])
  
  <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">creator</span> = <span class="ruby-ivar">@current_user</span>
  <span class="ruby-comment">#@publication.creator_type = &quot;User&quot;</span>
  <span class="ruby-comment">#@publication.creator_id = @current_user</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">branch_from_master</span>
    
    <span class="ruby-comment"># need to remove repeat against publication model</span>
    <span class="ruby-identifier">e</span> = <span class="ruby-constant">Event</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">e</span>.<span class="ruby-identifier">category</span> = <span class="ruby-string">&quot;started editing&quot;</span>
    <span class="ruby-identifier">e</span>.<span class="ruby-identifier">target</span> = <span class="ruby-ivar">@publication</span>
    <span class="ruby-identifier">e</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-ivar">@current_user</span>
    <span class="ruby-identifier">e</span>.<span class="ruby-identifier">save!</span>
    
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">'Publication was successfully created.'</span>
    <span class="ruby-identifier">expire_publication_cache</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">edit_polymorphic_path</span>([<span class="ruby-ivar">@publication</span>, <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">entry_identifier</span>])
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">'Error creating publication'</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create-source -->
          
        </div>

        

        
      </div><!-- create-method -->

    
      <div id="method-i-create_from_identifier" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_from_identifier</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="create_from_identifier-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 49</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_from_identifier</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">'You must specify an identifier.'</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">identifier</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
  
  <span class="ruby-identifier">related_identifiers</span> = <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span>.<span class="ruby-identifier">identifier_to_identifiers</span>(<span class="ruby-identifier">identifier</span>)
  
  <span class="ruby-identifier">publication_from_identifier</span>(<span class="ruby-identifier">identifier</span>, <span class="ruby-identifier">related_identifiers</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_from_identifier-source -->
          
        </div>

        

        
      </div><!-- create_from_identifier-method -->

    
      <div id="method-i-create_from_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_from_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>list is in the form of pn idâ€™s separated by returns</p>

<pre>such as</pre>

<p>papyri.info/ddbdp/bgu;7;1504 papyri.info/ddbdp/bgu;7;1505
papyri.info/ddbdp/bgu;7;1506</p>
          

          
          <div class="method-source-code" id="create_from_list-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 84</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_from_list</span>
  <span class="ruby-identifier">id_list</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:pn_id_list</span>].<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\s+/</span>) <span class="ruby-comment">#(/\r\n?/)</span>
  <span class="ruby-identifier">list_is_good</span> = <span class="ruby-keyword">true</span>
  
  <span class="ruby-comment">#get rid of any blank lines, etc</span>
  <span class="ruby-identifier">id_list</span> = <span class="ruby-identifier">id_list</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span> }
  
  <span class="ruby-comment">#check that the list is in the correct form</span>
  <span class="ruby-comment">#clean up the ids</span>
  <span class="ruby-identifier">id_list</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># FIXME: once biblio is loaded into numbers server, remove this unless clause</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">id</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/#{NumbersRDF::NAMESPACE_IDENTIFIER}\/#{BiblioIdentifier::IDENTIFIER_NAMESPACE}/</span>
      <span class="ruby-identifier">id</span>.<span class="ruby-identifier">chomp!</span>(<span class="ruby-string">'/'</span>);
      <span class="ruby-identifier">id</span> = <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span>.<span class="ruby-identifier">identifier_url_to_identifier</span>(<span class="ruby-identifier">id</span>)
      <span class="ruby-comment">#check if there is a good response from the number server</span>
      <span class="ruby-identifier">response</span> =  <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span>.<span class="ruby-identifier">identifier_to_numbers_server_response</span>(<span class="ruby-identifier">id</span>)
      
      <span class="ruby-comment">#puts id + &quot; returned &quot; + response.code # + response.body</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'200'</span>
        
        <span class="ruby-comment">#bad format most likely</span>
        <span class="ruby-identifier">id</span> = <span class="ruby-string">&quot;Numbers Server Error, Check format--&gt; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">id</span>
        <span class="ruby-identifier">list_is_good</span> = <span class="ruby-keyword">false</span>
        
      <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">index</span>(<span class="ruby-string">'rdf:Description'</span>)
        
        <span class="ruby-comment">#item does not exist most likely</span>
        <span class="ruby-comment">#puts &quot;text is bad&quot;</span>
        <span class="ruby-identifier">id</span> = <span class="ruby-string">&quot;Not Found--&gt; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">id</span>
        <span class="ruby-identifier">list_is_good</span> = <span class="ruby-keyword">false</span>
        
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">id</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">list_is_good</span>
    <span class="ruby-comment">#recreate list</span>
    <span class="ruby-identifier">error_str</span>  = <span class="ruby-string">&quot;Unable to create Publication.&lt;br /&gt;&quot;</span>
    <span class="ruby-identifier">id_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span>
     <span class="ruby-identifier">error_str</span> = <span class="ruby-identifier">error_str</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">id</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&lt;br /&gt;&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">error_str</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'advanced_create'</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  
  
  <span class="ruby-comment">#clean up any duplicated lines</span>
  <span class="ruby-identifier">id_list</span> = <span class="ruby-identifier">id_list</span>.<span class="ruby-identifier">uniq</span>
  
  <span class="ruby-identifier">publication_from_identifiers</span>(<span class="ruby-identifier">id_list</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_from_list-source -->
          
        </div>

        

        
      </div><!-- create_from_list-method -->

    
      <div id="method-i-create_from_selector" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_from_selector</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="create_from_selector-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 466</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_from_selector</span>
  <span class="ruby-identifier">identifier_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:IdentifierClass</span>]
  <span class="ruby-identifier">collection</span> = <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;#{identifier_class}CollectionSelect&quot;</span>.<span class="ruby-identifier">intern</span>]
  <span class="ruby-identifier">volume</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:volume_number</span>]
  <span class="ruby-identifier">document</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:document_number</span>]
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">volume</span> <span class="ruby-operator">==</span> <span class="ruby-string">'Volume Number'</span>
    <span class="ruby-identifier">volume</span> = <span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">document</span> <span class="ruby-operator">==</span> <span class="ruby-string">'Document Number'</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">document</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">'Error creating publication: you must specify a document number'</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">identifier_class</span> <span class="ruby-operator">==</span> <span class="ruby-string">'DDBIdentifier'</span>
    <span class="ruby-identifier">document_path</span> = [<span class="ruby-identifier">collection</span>, <span class="ruby-identifier">volume</span>, <span class="ruby-identifier">document</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">';'</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">identifier_class</span> <span class="ruby-operator">==</span> <span class="ruby-string">'HGVIdentifier'</span>
    <span class="ruby-identifier">collection</span> = <span class="ruby-identifier">collection</span>.<span class="ruby-identifier">tr</span>(<span class="ruby-string">' '</span>, <span class="ruby-string">'_'</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">volume</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-identifier">document_path</span> = [<span class="ruby-identifier">collection</span>, <span class="ruby-identifier">document</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">'_'</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">document_path</span> = [<span class="ruby-identifier">collection</span>, <span class="ruby-identifier">volume</span>, <span class="ruby-identifier">document</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">'_'</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">namespace</span> = <span class="ruby-identifier">identifier_class</span>.<span class="ruby-identifier">constantize</span><span class="ruby-operator">::</span><span class="ruby-constant">IDENTIFIER_NAMESPACE</span>
  
  <span class="ruby-identifier">identifier</span> = [<span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NAMESPACE_IDENTIFIER</span>, <span class="ruby-identifier">namespace</span>, <span class="ruby-identifier">document_path</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">'/'</span>)
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">identifier_class</span> <span class="ruby-operator">==</span> <span class="ruby-string">'HGVIdentifier'</span>
    <span class="ruby-identifier">related_identifiers</span> = <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span>.<span class="ruby-identifier">collection_identifier_to_identifiers</span>(<span class="ruby-identifier">identifier</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">related_identifiers</span> = <span class="ruby-constant">NumbersRDF</span><span class="ruby-operator">::</span><span class="ruby-constant">NumbersHelper</span>.<span class="ruby-identifier">identifier_to_identifiers</span>(<span class="ruby-identifier">identifier</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">publication_from_identifier</span>(<span class="ruby-identifier">identifier</span>, <span class="ruby-identifier">related_identifiers</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_from_selector-source -->
          
        </div>

        

        
      </div><!-- create_from_selector-method -->

    
      <div id="method-i-create_from_templates" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_from_templates</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="create_from_templates-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_from_templates</span>
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">new_from_templates</span>(<span class="ruby-ivar">@current_user</span>)
  
  <span class="ruby-comment"># need to remove repeat against publication model</span>
  <span class="ruby-identifier">e</span> = <span class="ruby-constant">Event</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">e</span>.<span class="ruby-identifier">category</span> = <span class="ruby-string">&quot;created&quot;</span>
  <span class="ruby-identifier">e</span>.<span class="ruby-identifier">target</span> = <span class="ruby-ivar">@publication</span>
  <span class="ruby-identifier">e</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-ivar">@current_user</span>
  <span class="ruby-identifier">e</span>.<span class="ruby-identifier">save!</span>
  
  <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">'Publication was successfully created.'</span>
  <span class="ruby-comment">#redirect_to edit_polymorphic_path([@publication, @publication.entry_identifier])</span>
  <span class="ruby-identifier">expire_publication_cache</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@publication</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_from_templates-source -->
          
        </div>

        

        
      </div><!-- create_from_templates-method -->

    
      <div id="method-i-destroy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>DELETE</p>
          

          
          <div class="method-source-code" id="destroy-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 651</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy</span>
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-identifier">pub_name</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">title</span>
  <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">destroy</span>
  
  <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">'Publication '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pub_name</span> <span class="ruby-operator">+</span> <span class="ruby-string">' was successfully deleted.'</span>
  <span class="ruby-identifier">expire_publication_cache</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span> }
    
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- destroy-source -->
          
        </div>

        

        
      </div><!-- destroy-method -->

    
      <div id="method-i-determine_creatable_identifiers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">determine_creatable_identifiers</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="determine_creatable_identifiers-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 10</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">determine_creatable_identifiers</span>
  <span class="ruby-ivar">@creatable_identifiers</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">creatable_identifiers</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- determine_creatable_identifiers-source -->
          
        </div>

        

        
      </div><!-- determine_creatable_identifiers-method -->

    
      <div id="method-i-edit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /publications/1/edit</p>
          

          
          <div class="method-source-code" id="edit-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 385</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit</span>
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">edit_polymorphic_path</span>([<span class="ruby-ivar">@publication</span>, <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">entry_identifier</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit-source -->
          
        </div>

        

        
      </div><!-- edit-method -->

    
      <div id="method-i-edit_adjacent" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_adjacent</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_adjacent-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 415</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_adjacent</span>

  <span class="ruby-comment">#if they are on show, then need to goto first or last identifers</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:current_action_name</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;show&quot;</span>
    <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:direction</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'prev'</span>
      <span class="ruby-ivar">@identifier</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">identifiers</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@identifier</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">identifiers</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">edit_polymorphic_path</span>([<span class="ruby-ivar">@publication</span>, <span class="ruby-ivar">@identifier</span>])
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:pub_id</span>])

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:direction</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'prev'</span>
    <span class="ruby-identifier">direction</span> = <span class="ruby-value">-1</span>
  <span class="ruby-keyword">else</span> <span class="ruby-comment">#assume next params[:direction] == 'next'</span>
    <span class="ruby-identifier">direction</span> = <span class="ruby-value">1</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@identifier</span> = <span class="ruby-constant">Identifier</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id_id</span>])
  <span class="ruby-identifier">current_identifier_class</span> = <span class="ruby-ivar">@identifier</span>.<span class="ruby-identifier">class</span>
  <span class="ruby-identifier">current_index</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">identifiers</span>.<span class="ruby-identifier">index</span>(<span class="ruby-ivar">@identifier</span>)

  <span class="ruby-identifier">return_index</span> = <span class="ruby-identifier">current_index</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">direction</span>
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">return_index</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>)
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@publication</span>
    <span class="ruby-keyword">return</span>
    <span class="ruby-comment">#or for loop over without overview</span>
    <span class="ruby-comment">#return_index = @publication.identifiers.length - 1</span>
  <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">return_index</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">identifiers</span>.<span class="ruby-identifier">length</span>)
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@publication</span>
    <span class="ruby-keyword">return</span>
    <span class="ruby-comment">#or for loop over without overview</span>
    <span class="ruby-comment">#return_index = 0</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@identifier</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">identifiers</span>[<span class="ruby-identifier">return_index</span>]
  <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@identifier</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">current_identifier_class</span>)
    <span class="ruby-comment">#if no longer the same class, we can't assume that the next class as the same edit methods</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">edit_polymorphic_path</span>([<span class="ruby-ivar">@publication</span>, <span class="ruby-ivar">@identifier</span>])
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#/publications/1/identifiers/1/action</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:current_controller_name</span>], <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:current_action_name</span>], <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@identifier</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:publication_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:pub_id</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit_adjacent-source -->
          
        </div>

        

        
      </div><!-- edit_adjacent-method -->

    
      <div id="method-i-edit_biblio" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_biblio</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_biblio-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 409</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_biblio</span>
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-ivar">@identifier</span> = <span class="ruby-constant">BiblioIdentifier</span>.<span class="ruby-identifier">find_by_publication_id</span>(<span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">edit_polymorphic_path</span>([<span class="ruby-ivar">@publication</span>, <span class="ruby-ivar">@identifier</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit_biblio-source -->
          
        </div>

        

        
      </div><!-- edit_biblio-method -->

    
      <div id="method-i-edit_meta" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_meta</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_meta-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 397</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_meta</span>
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-ivar">@identifier</span> = <span class="ruby-constant">HGVMetaIdentifier</span>.<span class="ruby-identifier">find_by_publication_id</span>(<span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">edit_polymorphic_path</span>([<span class="ruby-ivar">@publication</span>, <span class="ruby-ivar">@identifier</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit_meta-source -->
          
        </div>

        

        
      </div><!-- edit_meta-method -->

    
      <div id="method-i-edit_text" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_text</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_text-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 391</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_text</span>
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-ivar">@identifier</span> = <span class="ruby-constant">DDBIdentifier</span>.<span class="ruby-identifier">find_by_publication_id</span>(<span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">edit_polymorphic_path</span>([<span class="ruby-ivar">@publication</span>, <span class="ruby-ivar">@identifier</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit_text-source -->
          
        </div>

        

        
      </div><!-- edit_text-method -->

    
      <div id="method-i-edit_trans" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_trans</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_trans-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 403</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_trans</span>  
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])    
  <span class="ruby-ivar">@identifier</span> = <span class="ruby-constant">HGVTransIdentifier</span>.<span class="ruby-identifier">find_by_publication_id</span>(<span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">edit_polymorphic_path</span>([<span class="ruby-ivar">@publication</span>, <span class="ruby-ivar">@identifier</span>])    
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit_trans-source -->
          
        </div>

        

        
      </div><!-- edit_trans-method -->

    
      <div id="method-i-finalize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">finalize</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="finalize-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 257</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">finalize</span>
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])

  <span class="ruby-comment">#to prevent a community publication from being finalized if there is no end_user to get the final version</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">is_community_publication?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">community</span>.<span class="ruby-identifier">end_user</span>.<span class="ruby-identifier">nil?</span> 
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">&quot;Error finalizing. No End User for the community.&quot;</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@publication</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment">#find all modified identiers in the publication so we can set the votes into the xml</span>
  <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">identifiers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span>
    <span class="ruby-comment">#board controls this id and it has been modified</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">id</span>.<span class="ruby-identifier">modified?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">find_first_board</span>.<span class="ruby-identifier">controls_identifier?</span>(<span class="ruby-identifier">id</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">id</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;BiblioIdentifier&quot;</span>)
      <span class="ruby-identifier">id</span>.<span class="ruby-identifier">update_revision_desc</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:comment</span>], <span class="ruby-ivar">@current_user</span>);
      <span class="ruby-identifier">id</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  
  <span class="ruby-comment">#copy back in any case</span>
  <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">copy_back_to_user</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:comment</span>], <span class="ruby-ivar">@current_user</span>)

  <span class="ruby-comment">#if it is a community pub, we don't commit to canon</span>
  <span class="ruby-comment">#instead we copy changes back to origin</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">is_community_publication?</span>
    
    <span class="ruby-comment">#@publication.copy_back_to_user(params[:comment], @current_user)</span>

    
  <span class="ruby-keyword">else</span> <span class="ruby-comment">#commit to canon</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">canon_sha</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">commit_to_canon</span>
      <span class="ruby-identifier">expire_publication_cache</span>(<span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">creator</span>.<span class="ruby-identifier">id</span>)
      <span class="ruby-identifier">expire_fragment</span>(<span class="ruby-regexp">/board_publications_\d+/</span>)
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EACCES</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">git_permissions_error</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-node">&quot;Error finalizing. Error message was: #{git_permissions_error.message}. This is likely a filesystems permissions error on the canonical Git repository. Please contact your system administrator.&quot;</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@publication</span>
      <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>    
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment">#go ahead and store a comment on finalize even if the user makes no comment...so we have a record of the action  </span>
  <span class="ruby-ivar">@comment</span> = <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">new</span>()

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:comment</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:comment</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span>  
    <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:comment</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-string">&quot;no comment&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">user</span> = <span class="ruby-ivar">@current_user</span>
  <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">reason</span> = <span class="ruby-string">&quot;finalizing&quot;</span>
  <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">git_hash</span> = <span class="ruby-identifier">canon_sha</span>
  <span class="ruby-comment">#associate comment with original identifier/publication</span>
  <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">identifier_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:identifier_id</span>]
  <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">publication</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">origin</span>
  
  <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">save</span>
  
  <span class="ruby-comment">#create an event to show up on dashboard</span>
  <span class="ruby-ivar">@event</span> = <span class="ruby-constant">Event</span>.<span class="ruby-identifier">new</span>()
  <span class="ruby-ivar">@event</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-ivar">@current_user</span>
  <span class="ruby-ivar">@event</span>.<span class="ruby-identifier">target</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">parent</span> <span class="ruby-comment">#used parent so would match approve event</span>
  <span class="ruby-ivar">@event</span>.<span class="ruby-identifier">category</span> = <span class="ruby-string">&quot;committed&quot;</span>
  <span class="ruby-ivar">@event</span>.<span class="ruby-identifier">save!</span>
  
  <span class="ruby-comment">#TODO need to submit to next board</span>
  <span class="ruby-comment">#need to set status of ids</span>
  <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">set_origin_and_local_identifier_status</span>(<span class="ruby-string">&quot;committed&quot;</span>)
  <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">set_board_identifier_status</span>(<span class="ruby-string">&quot;committed&quot;</span>)
  
  <span class="ruby-comment">#as it is set up the finalizer will have a parent that is a board whose status must be set</span>
  <span class="ruby-comment">#check that parent is board</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">parent</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">owner_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Board&quot;</span>              
    <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">archive</span>
    <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">owner</span>.<span class="ruby-identifier">send_status_emails</span>(<span class="ruby-string">&quot;committed&quot;</span>, <span class="ruby-ivar">@publication</span>)
  <span class="ruby-comment">#else #the user is a super user</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment">#send publication to the next board</span>
  <span class="ruby-identifier">error_text</span>, <span class="ruby-identifier">identifier_for_comment</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">origin</span>.<span class="ruby-identifier">submit_to_next_board</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">error_text</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">error_text</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">change_status</span>(<span class="ruby-string">'finalized'</span>)
  
  <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">'Publication finalized.'</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@publication</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- finalize-source -->
          
        </div>

        

        
      </div><!-- finalize-method -->

    
      <div id="method-i-finalize_review" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">finalize_review</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="finalize_review-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 234</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">finalize_review</span>
  
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-ivar">@identifier</span> = <span class="ruby-keyword">nil</span><span class="ruby-comment">#@publication.entry_identifier</span>
  <span class="ruby-comment">#if we are finalizing then find the board that this pub came from </span>
  <span class="ruby-comment"># and find the identifers that the board controls</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">owner_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Board&quot;</span>
    <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">identifiers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">owner</span>.<span class="ruby-identifier">controls_identifier?</span>(<span class="ruby-identifier">id</span>)
        <span class="ruby-ivar">@identifier</span> = <span class="ruby-identifier">id</span>
        <span class="ruby-comment">#TODO change to array if board can control multiple identifiers</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>      
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@diff</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">diff_from_canon</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@diff</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">&quot;WARNING: Diff from canon is empty. Something may be wrong.&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@is_editor_view</span> = <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- finalize_review-source -->
          
        </div>

        

        
      </div><!-- finalize_review-method -->

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /publications GET /publications.xml</p>
          

          
          <div class="method-source-code" id="index-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 196</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>
  <span class="ruby-ivar">@branches</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">repository</span>.<span class="ruby-identifier">branches</span>
  <span class="ruby-ivar">@branches</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;master&quot;</span>)
  
  <span class="ruby-ivar">@publications</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find_all_by_owner_id</span>(<span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span>)
  <span class="ruby-comment"># just give branches that don't have corresponding publications</span>
  <span class="ruby-ivar">@branches</span> <span class="ruby-operator">-=</span> <span class="ruby-ivar">@publications</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">branch</span>}

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment"># index.html.erb</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-value">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@publications</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- index-source -->
          
        </div>

        

        
      </div><!-- index-method -->

    
      <div id="method-i-master_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">master_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="master_list-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 665</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">master_list</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">developer</span>
    <span class="ruby-ivar">@publications</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- master_list-source -->
          
        </div>

        

        
      </div><!-- master_list-method -->

    
      <div id="method-i-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 6</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
      <div id="method-i-show" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /publications/1 GET /publications/1.xml</p>
          

          
          <div class="method-source-code" id="show-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 350</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show</span>
  
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-keyword">rescue</span>    
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">&quot;Publication not found&quot;</span>
    <span class="ruby-identifier">redirect_to</span> (<span class="ruby-identifier">dashboard_url</span>)
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@is_editor_view</span> = <span class="ruby-keyword">true</span> 
  <span class="ruby-ivar">@all_comments</span>, <span class="ruby-ivar">@xml_only_comments</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">get_all_comments</span>(<span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">title</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;/&quot;</span>).<span class="ruby-identifier">last</span>)

  <span class="ruby-ivar">@show_submit</span> = <span class="ruby-identifier">allow_submit?</span>
  
  <span class="ruby-comment">#only let creator delete</span>
  <span class="ruby-ivar">@allow_delete</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">creator</span>.<span class="ruby-identifier">id</span> 
  <span class="ruby-comment">#only delete new or editing</span>
  <span class="ruby-ivar">@allow_delete</span> = <span class="ruby-ivar">@allow_delete</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;new&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;editing&quot;</span>)
  <span class="ruby-ivar">@identifier</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">entry_identifier</span>
  
  <span class="ruby-comment">#todo - if any part has been approved, do we want them to be able to delete the publication or force it to an archve? this would only happen if a board returns their part after another board has approved their part</span>
  
  <span class="ruby-comment">#find other users who are editing the same thing</span>
  <span class="ruby-ivar">@other_user_publications</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">other_users</span>(<span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">title</span>, <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span>)
  

  <span class="ruby-identifier">determine_creatable_identifiers</span>()
  
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment"># show.html.erb</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-value">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@publication</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- show-source -->
          
        </div>

        

        
      </div><!-- show-method -->

    
      <div id="method-i-submit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">submit</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="submit-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">submit</span>

  <span class="ruby-comment">#prevent resubmitting...most likely by impatient clicking on submit button</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span> <span class="ruby-node">%w{editing new}</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">status</span>)
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] =  <span class="ruby-string">'Publication has already been submitted. Did you click &quot;Submit&quot; multiple times?'</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@publication</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment">#check if we are submitting to a community</span>
  <span class="ruby-comment">#community_id = params[:community_id]</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:community</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:community</span>][<span class="ruby-value">:id</span>]
    <span class="ruby-identifier">community_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:community</span>][<span class="ruby-value">:id</span>]
    <span class="ruby-identifier">community_id</span>.<span class="ruby-identifier">strip</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">community_id</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">community_id</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;0&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">community_id</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">community_id</span> = <span class="ruby-identifier">community_id</span>
      <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Publication &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; will be submitted to &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">community</span>.<span class="ruby-identifier">format_name</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#force community id to nil for sosol</span>
      <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">community_id</span> = <span class="ruby-keyword">nil</span>;        
      <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Publication &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; will be submitted to SoSOL&quot;</span>
    <span class="ruby-keyword">end</span>
    
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#force community id to 0 for sosol</span>
    <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">community_id</span> = <span class="ruby-keyword">nil</span>;
  <span class="ruby-keyword">end</span>
  
  
  <span class="ruby-comment">#need to set id to 0</span>
  <span class="ruby-comment">#raise community_id</span>
  
  <span class="ruby-comment">#@comment = Comment.new( {:git_hash =&gt; @publication.recent_submit_sha, :publication_id =&gt; params[:id], :comment =&gt; params[:submit_comment], :reason =&gt; &quot;submit&quot;, :user_id =&gt; @current_user.id } )</span>
  <span class="ruby-comment">#git hash is not yet known, but we need the comment for the publication.submit to add to the changeDesc</span>
  <span class="ruby-ivar">@comment</span> = <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">new</span>( {<span class="ruby-value">:publication_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>], <span class="ruby-value">:comment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:submit_comment</span>], <span class="ruby-value">:reason</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;submit&quot;</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span> } )
  <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">save</span>
  
  <span class="ruby-identifier">error_text</span>, <span class="ruby-identifier">identifier_for_comment</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">submit</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">error_text</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-comment">#update comment with git hash when successfully submitted</span>
    <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">git_hash</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">recent_submit_sha</span>
    <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">identifier_id</span> = <span class="ruby-identifier">identifier_for_comment</span>
    <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-identifier">expire_publication_cache</span>
    <span class="ruby-identifier">expire_fragment</span>(<span class="ruby-regexp">/board_publications_\d+/</span>)
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">'Publication submitted.'</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#cleanup comment that was inserted before submit completed that is no longer valid because of submit error</span>
    <span class="ruby-identifier">cleanup_id</span> = <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:last</span>, <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:publication_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>], <span class="ruby-value">:reason</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;submit&quot;</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span> } )
    <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">destroy</span>(<span class="ruby-identifier">cleanup_id</span>)
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">error_text</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@publication</span>
  <span class="ruby-comment"># redirect_to edit_polymorphic_path([@publication, @publication.entry_identifier])</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- submit-source -->
          
        </div>

        

        
      </div><!-- submit-method -->

    
      <div id="method-i-vote" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">vote</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="vote-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 506</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">vote</span>
  <span class="ruby-comment">#note that votes will go with the boards copy of the pub and identifiers</span>
  <span class="ruby-comment">#  vote history will also be recorded in the comment of the origin pub and identifier</span>
  
  <span class="ruby-comment">#fails - if not pub found ie race condition of voting on reject or graffiti</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])  
  <span class="ruby-keyword">rescue</span>    
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:warning</span>] = <span class="ruby-string">&quot;Publication not found - voting is over for this publications.&quot;</span>
    <span class="ruby-identifier">redirect_to</span> (<span class="ruby-identifier">dashboard_url</span>)
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#fails - vote choice not given</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:vote</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:vote</span>][<span class="ruby-value">:choice</span>].<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">&quot;You must select a vote choice.&quot;</span>
    
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">edit_polymorphic_path</span>([<span class="ruby-ivar">@publication</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:vote</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">entry_identifier</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Identifier</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:vote</span>][<span class="ruby-value">:identifier_id</span>])])
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#fails - voting is over</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;voting&quot;</span> 
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:warning</span>] = <span class="ruby-string">&quot;Voting is over for this publication.&quot;</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@publication</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-constant">Vote</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment">#note that votes go to the publication's identifier</span>
    <span class="ruby-ivar">@vote</span> = <span class="ruby-constant">Vote</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:vote</span>])
    <span class="ruby-ivar">@vote</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span>
    
    <span class="ruby-identifier">vote_identifier</span> = <span class="ruby-ivar">@vote</span>.<span class="ruby-identifier">identifier</span>.<span class="ruby-identifier">lock!</span>
    <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">lock!</span>

    <span class="ruby-comment">#fails - publication not in correct ownership</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">owner_type</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Board&quot;</span>
      <span class="ruby-comment">#we have a problem since no one should be voting on a publication if it is not in theirs</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">&quot;You do not have permission to vote on this publication which you do not own!&quot;</span>
      <span class="ruby-comment">#kind a harsh but send em back to their own dashboard</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
      <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@vote</span>.<span class="ruby-identifier">board_id</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">owner_id</span>
    <span class="ruby-keyword">end</span>
  
    <span class="ruby-ivar">@comment</span> = <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">new</span>()
    <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-ivar">@vote</span>.<span class="ruby-identifier">choice</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; - &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:comment</span>][<span class="ruby-value">:comment</span>]
    <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">user</span> = <span class="ruby-ivar">@current_user</span>
    <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">reason</span> = <span class="ruby-string">&quot;vote&quot;</span>
    <span class="ruby-comment">#use most recent sha from identifier</span>
    <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">git_hash</span> = <span class="ruby-identifier">vote_identifier</span>.<span class="ruby-identifier">get_recent_commit_sha</span>
    <span class="ruby-comment">#associate comment with original identifier/publication</span>
    <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">identifier</span> = <span class="ruby-identifier">vote_identifier</span>.<span class="ruby-identifier">origin</span>   
    <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">publication</span> = <span class="ruby-ivar">@vote</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">origin</span>

    <span class="ruby-comment">#double check that they have not already voted</span>
    <span class="ruby-comment">#has_voted = vote_identifier.votes.find_by_user_id(@current_user.id)</span>
    <span class="ruby-identifier">has_voted</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">user_has_voted?</span>(<span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">has_voted</span> 
      <span class="ruby-ivar">@comment</span>.<span class="ruby-identifier">save!</span>
      <span class="ruby-ivar">@vote</span>.<span class="ruby-identifier">save!</span>
      <span class="ruby-comment"># invalidate their cache since an action may have changed its status</span>
      <span class="ruby-identifier">expire_publication_cache</span>(<span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">creator</span>.<span class="ruby-identifier">id</span>)
      <span class="ruby-identifier">expire_fragment</span>(<span class="ruby-regexp">/board_publications_\d+/</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment">#see if publication still exists</span>
    <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@publication</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">rescue</span>
    <span class="ruby-comment">#voting destroyed publication so go to the dashboard</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- vote-source -->
          
        </div>

        

        
      </div><!-- vote-method -->

    
      <div id="method-i-withdraw" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">withdraw</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="withdraw-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 625</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">withdraw</span>
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-identifier">pub_name</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">title</span>
  <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">withdraw</span>
  
  <span class="ruby-comment">#send email to the user informing them of the withdraw</span>
  <span class="ruby-comment">#EmailerMailer.deliver_send_withdraw_note(@publication.creator.email, @publication.title )</span>
  <span class="ruby-identifier">address</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">creator</span>.<span class="ruby-identifier">email</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">address</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">address</span>.<span class="ruby-identifier">strip</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-constant">EmailerMailer</span>.<span class="ruby-identifier">deliver_send_withdraw_note</span>(<span class="ruby-identifier">address</span>, <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">title</span> )                       
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
      <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span>(<span class="ruby-node">&quot;Error sending withdraw email: #{e.class.to_s}, #{e.to_s}&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">'Publication '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pub_name</span> <span class="ruby-operator">+</span> <span class="ruby-string">' was successfully withdrawn.'</span>
  <span class="ruby-identifier">expire_publication_cache</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- withdraw-source -->
          
        </div>

        

        
      </div><!-- withdraw-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Protected Instance Methods</h3>

    
      <div id="method-i-allow_submit-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">allow_submit?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="allow_submit-3F-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 686</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">allow_submit?</span>
  <span class="ruby-comment">#check if publication has been changed by user</span>
  <span class="ruby-identifier">allow</span> = <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">modified?</span>
  
  <span class="ruby-comment">#only let creator submit</span>
  <span class="ruby-identifier">allow</span> = <span class="ruby-identifier">allow</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">creator_id</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span> 
  
  <span class="ruby-comment">#only let user submit, don't let a board member submit</span>
  <span class="ruby-identifier">allow</span> = <span class="ruby-identifier">allow</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">owner_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;User&quot;</span>
  
  <span class="ruby-comment">#dont let user submit if already submitted, or committed etc..</span>
  <span class="ruby-identifier">allow</span> = <span class="ruby-identifier">allow</span> <span class="ruby-operator">&amp;&amp;</span> ((<span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;editing&quot;</span>) <span class="ruby-operator">||</span> (<span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;new&quot;</span>))
  
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">allow</span>
  
  <span class="ruby-comment">#below bypassed until we have return mechanism in place</span>
  
  <span class="ruby-comment">#check if any part of the publication is still being edited (ie not already submitted)</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">allow</span> <span class="ruby-comment">#something has been modified so lets see if they can submit it</span>
    <span class="ruby-identifier">allow</span> = <span class="ruby-keyword">false</span> <span class="ruby-comment">#dont let them submit unless something is in edit status</span>
    <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">identifiers</span>.<span class="ruby-identifier">each</span>  <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">identifier</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">identifier</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">identifier</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;editing&quot;</span> 
        <span class="ruby-identifier">allow</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>        
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
 <span class="ruby-identifier">allow</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- allow_submit-3F-source -->
          
        </div>

        

        
      </div><!-- allow_submit-3F-method -->

    
      <div id="method-i-archive_pub" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">archive_pub</span><span
            class="method-args">(pub_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="archive_pub-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 836</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">archive_pub</span>(<span class="ruby-identifier">pub_id</span>)
  <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">pub_id</span>)
  <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">archive</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- archive_pub-source -->
          
        </div>

        

        
      </div><!-- archive_pub-method -->

    
      <div id="method-i-expire_publication_cache" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">expire_publication_cache</span><span
            class="method-args">(user_id = @current_user.id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="expire_publication_cache-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 832</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">expire_publication_cache</span>(<span class="ruby-identifier">user_id</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">expire_fragment</span>(<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'user'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dashboard'</span>, <span class="ruby-value">:part</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;your_publications_#{user_id}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- expire_publication_cache-source -->
          
        </div>

        

        
      </div><!-- expire_publication_cache-method -->

    
      <div id="method-i-find_publication" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_publication</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="find_publication-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 674</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_publication</span>
  <span class="ruby-ivar">@publication</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_publication-source -->
          
        </div>

        

        
      </div><!-- find_publication-method -->

    
      <div id="method-i-ownership_guard" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ownership_guard</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="ownership_guard-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 678</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ownership_guard</span>
  <span class="ruby-identifier">find_publication</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">mutable_by?</span>(<span class="ruby-ivar">@current_user</span>)
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">'Operation not permitted.'</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- ownership_guard-source -->
          
        </div>

        

        
      </div><!-- ownership_guard-method -->

    
      <div id="method-i-publication_from_identifier" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">publication_from_identifier</span><span
            class="method-args">(identifier, related_identifiers = nil, optional_title = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="publication_from_identifier-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 754</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">publication_from_identifier</span>(<span class="ruby-identifier">identifier</span>, <span class="ruby-identifier">related_identifiers</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">optional_title</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Identifier: #{identifier}&quot;</span>)
  <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Related identifiers: #{related_identifiers.inspect}&quot;</span>)

  <span class="ruby-identifier">conflicting_identifiers</span> = []

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">related_identifiers</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">'Error creating publication: publication not found'</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">related_identifiers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">relid</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">possible_conflicts</span> = <span class="ruby-constant">Identifier</span>.<span class="ruby-identifier">find_all_by_name</span>(<span class="ruby-identifier">relid</span>, <span class="ruby-value">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:publication</span>)
    <span class="ruby-identifier">actual_conflicts</span> = <span class="ruby-identifier">possible_conflicts</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">pc</span><span class="ruby-operator">|</span> ((<span class="ruby-identifier">pc</span>.<span class="ruby-identifier">publication</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">pc</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">owner</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@current_user</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span>(<span class="ruby-node">%w{archived finalized}</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">pc</span>.<span class="ruby-identifier">publication</span>.<span class="ruby-identifier">status</span>)))}
    <span class="ruby-identifier">conflicting_identifiers</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">actual_conflicts</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">related_identifiers</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">'Error creating publication: publication not found'</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">conflicting_identifiers</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-node">&quot;Conflicting identifiers: #{conflicting_identifiers.inspect}&quot;</span>)
    <span class="ruby-identifier">conflicting_publication</span> = <span class="ruby-identifier">conflicting_identifiers</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">publication</span>
    <span class="ruby-identifier">conflicting_publications</span> = <span class="ruby-identifier">conflicting_identifiers</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">ci</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ci</span>.<span class="ruby-identifier">publication</span>}.<span class="ruby-identifier">uniq</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">conflicting_publications</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-string">'Error creating publication: multiple conflicting publications'</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] <span class="ruby-operator">+=</span> <span class="ruby-string">'&lt;ul&gt;'</span>
      <span class="ruby-identifier">conflicting_publications</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">conf_pub</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&lt;li&gt;&lt;a href='#{url_for(conf_pub)}'&gt;#{conf_pub.title}&lt;/a&gt;&lt;/li&gt;&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] <span class="ruby-operator">+=</span> <span class="ruby-string">'&lt;/ul&gt;'</span>

      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
      <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">conflicting_publication</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;committed&quot;</span>)
      <span class="ruby-comment"># TODO: should set &quot;archived&quot; and take approp action here instead</span>
      <span class="ruby-comment">#conflicting_publication.destroy</span>
      <span class="ruby-identifier">expire_publication_cache</span>
      <span class="ruby-identifier">conflicting_publication</span>.<span class="ruby-identifier">archive</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-node">&quot;Error creating publication: publication already exists. Please delete the &lt;a href='#{url_for(conflicting_publication)}'&gt;conflicting publication&lt;/a&gt; if you have not submitted it and would like to start from scratch.&quot;</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
      <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># else</span>
    <span class="ruby-ivar">@publication</span> = <span class="ruby-constant">Publication</span>.<span class="ruby-identifier">new</span>()
    <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-ivar">@current_user</span>
    <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">creator</span> = <span class="ruby-ivar">@current_user</span>
    <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">populate_identifiers_from_identifiers</span>(
      <span class="ruby-identifier">related_identifiers</span>, <span class="ruby-identifier">optional_title</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">save!</span>
      <span class="ruby-ivar">@publication</span>.<span class="ruby-identifier">branch_from_master</span>

      <span class="ruby-comment"># need to remove repeat against publication model</span>
      <span class="ruby-identifier">e</span> = <span class="ruby-constant">Event</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-identifier">e</span>.<span class="ruby-identifier">category</span> = <span class="ruby-string">&quot;started editing&quot;</span>
      <span class="ruby-identifier">e</span>.<span class="ruby-identifier">target</span> = <span class="ruby-ivar">@publication</span>
      <span class="ruby-identifier">e</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-ivar">@current_user</span>
      <span class="ruby-identifier">e</span>.<span class="ruby-identifier">save!</span>

      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">'Publication was successfully created.'</span>
      <span class="ruby-identifier">expire_publication_cache</span>
      <span class="ruby-comment">#redirect_to edit_polymorphic_path([@publication, @publication.entry_identifier])</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@publication</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">'Error creating publication'</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">dashboard_url</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- publication_from_identifier-source -->
          
        </div>

        

        
      </div><!-- publication_from_identifier-method -->

    
      <div id="method-i-publication_from_identifiers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">publication_from_identifiers</span><span
            class="method-args">(identifiers)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="publication_from_identifiers-source">
            <pre><span class="ruby-comment"># File app/controllers/publications_controller.rb, line 716</span>
    <span class="ruby-keyword">def</span> <span class="ruby-identifier">publication_from_identifiers</span>(<span class="ruby-identifier">identifiers</span>)
      <span class="ruby-identifier">new_title</span> = <span class="ruby-string">'Batch_'</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d%b%Y_%H%M&quot;</span>)
      <span class="ruby-identifier">publication_from_identifier</span>(<span class="ruby-string">&quot;unused_place_holder&quot;</span>, <span class="ruby-identifier">identifiers</span>, <span class="ruby-identifier">new_title</span>)


<span class="ruby-comment">      #do we need to check for conflicts with the batches?
      #might be able to modify publication_from_identifier
      #where to get title? make them up based on time for now
      new_title = 'Batch_' + Time.now.strftime(&quot;%d%b%Y_%H%M&quot;) #12Jan2011_2359
      puts new_title
        @publication = Publication.new()
        @publication.owner = @current_user
        @publication.creator = @current_user

        @publication.populate_identifiers_from_identifiers(
          identifiers, new_title)

        if @publication.save!
          @publication.branch_from_master

          # need to remove repeat against publication model
          e = Event.new
          e.category = &quot;started editing&quot;
          e.target = @publication
          e.owner = @current_user
          e.save!

          flash[:notice] = 'Publication was successfully created.'
          expire_publication_cache
          redirect_to edit_polymorphic_path([@publication, @publication.entry_identifier])
        else
          flash[:notice] = 'Error creating publication'
          redirect_to dashboard_url
        end
</span>    <span class="ruby-keyword">end</span></pre>
          </div><!-- publication_from_identifiers-source -->
          
        </div>

        

        
      </div><!-- publication_from_identifiers-method -->

    
    </section><!-- protected-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.11.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

